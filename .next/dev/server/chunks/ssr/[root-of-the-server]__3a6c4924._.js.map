{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JhtG2/Jth/Git%20Repository/Home/finance-home/app/actions.ts"],"sourcesContent":["// app/actions.ts\r\n\"use server\";\r\n\r\nimport { PrismaClient } from '@prisma/client';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n// Evita instanciar múltiples clientes en desarrollo\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\nconst prisma = globalForPrisma.prisma || new PrismaClient();\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n\r\n// --- LEER TODOS LOS DATOS ---\r\nexport async function getFinanceData() {\r\n  const accounts = await prisma.account.findMany();\r\n  const categories = await prisma.category.findMany();\r\n  const transactions = await prisma.transaction.findMany({\r\n    orderBy: { date: 'desc' }\r\n  });\r\n  const fixedRules = await prisma.fixedRule.findMany();\r\n  const simulatorItems = await prisma.simulatorItem.findMany();\r\n\r\n  // Convertimos datos complejos para que React los entienda (Fechas y JSON)\r\n  const parsedCategories = categories.map(c => ({\r\n    ...c,\r\n    subCategories: c.subCategories ? JSON.parse(c.subCategories) : []\r\n  }));\r\n\r\n  const parsedTransactions = transactions.map(t => ({\r\n    ...t,\r\n    date: t.date.toISOString(), // React prefiere strings para fechas\r\n    accountId: t.accountId,\r\n    categoryId: t.categoryId\r\n  }));\r\n\r\n  return {\r\n    accounts,\r\n    categories: parsedCategories,\r\n    transactions: parsedTransactions,\r\n    fixedRules,\r\n    simulatorItems\r\n  };\r\n}\r\n\r\n// --- ACCIONES DE TRANSACCIONES ---\r\nexport async function createTransaction(data: any) {\r\n  // Convertimos la fecha string a Date real para la DB\r\n  await prisma.transaction.create({\r\n    data: {\r\n        type: data.type,\r\n        amount: data.amount,\r\n        budgetedAmount: data.budgetedAmount,\r\n        accountId: data.accountId,\r\n        categoryId: data.categoryId,\r\n        description: data.description,\r\n        date: new Date(data.date), \r\n        isFixed: data.isFixed || false,\r\n        isSavings: data.isSavings || false\r\n    }\r\n  });\r\n\r\n  // Actualizar Saldo de la Cuenta\r\n  const multiplier = data.type === 'income' ? 1 : -1;\r\n  await prisma.account.update({\r\n      where: { id: data.accountId },\r\n      data: { balance: { increment: data.amount * multiplier } }\r\n  });\r\n\r\n  revalidatePath('/'); // Recarga la página automáticamente\r\n}\r\n\r\n// --- ACCIONES DE CUENTAS ---\r\nexport async function createAccount(data: any) {\r\n  await prisma.account.create({ data });\r\n  revalidatePath('/');\r\n}\r\n\r\nexport async function deleteAccount(id: string) {\r\n  await prisma.account.delete({ where: { id } });\r\n  revalidatePath('/');\r\n}\r\n\r\n// --- ACCIONES DE CATEGORIAS ---\r\nexport async function createCategory(data: any) {\r\n  await prisma.category.create({\r\n    data: {\r\n        name: data.name,\r\n        type: data.type,\r\n        subCategories: JSON.stringify(data.subCategories || [])\r\n    }\r\n  });\r\n  revalidatePath('/');\r\n}\r\n\r\n// --- ACCIONES DE SIMULADOR ---\r\nexport async function saveSimulatorItem(data: any) {\r\n    // Si existe ID lo actualiza, si no, crea uno nuevo\r\n    const existing = await prisma.simulatorItem.findUnique({ where: { id: data.id } });\r\n    if (existing) {\r\n        await prisma.simulatorItem.update({ where: { id: data.id }, data: { name: data.name, amount: data.amount } });\r\n    } else {\r\n        await prisma.simulatorItem.create({ data });\r\n    }\r\n    revalidatePath('/simulator');\r\n}\r\n\r\nexport async function deleteSimulatorItem(id: string) {\r\n    await prisma.simulatorItem.delete({ where: { id } });\r\n    revalidatePath('/simulator');\r\n}\r\n\r\n// --- REGLAS FIJAS ---\r\nexport async function createFixedRule(data: any) {\r\n    await prisma.fixedRule.create({ data });\r\n    revalidatePath('/');\r\n}\r\n\r\n// --- FUNCIÓN PARA POBLAR DATOS INICIALES (SEED) ---\r\nexport async function seedDatabase() {\r\n  // 1. Crear Cuentas por defecto\r\n  const acc1 = await prisma.account.create({\r\n    data: { name: 'Davivienda', bank: 'Davivienda', type: 'bank', owner: 'Jhonattan', color: '#ef4444', balance: 0 }\r\n  });\r\n  \r\n  const acc2 = await prisma.account.create({\r\n    data: { name: 'Efectivo', bank: 'Cartera', type: 'cash', owner: 'Jhonattan', color: '#22c55e', balance: 0 }\r\n  });\r\n\r\n  // 2. Crear Categorías por defecto\r\n  await prisma.category.create({\r\n    data: { name: 'Salario', type: 'income', subCategories: JSON.stringify(['Nómina', 'Extra']) }\r\n  });\r\n  \r\n  await prisma.category.create({\r\n    data: { name: 'Alimentación', type: 'expense', subCategories: JSON.stringify(['Mercado', 'Restaurante']) }\r\n  });\r\n\r\n  await prisma.category.create({\r\n    data: { name: 'Transporte', type: 'expense', subCategories: JSON.stringify(['Uber', 'Bus', 'Gasolina']) }\r\n  });\r\n  \r\n  // Categoría especial para Ahorros\r\n  await prisma.category.create({\r\n    data: { id: 'cat_sys_savings', name: 'Ahorro Automático', type: 'income', subCategories: '[]' }\r\n  });\r\n\r\n  revalidatePath('/');\r\n  return { success: true };\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 255, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/JhtG2/Jth/Git%20Repository/Home/finance-home/.next-internal/server/app/simulator/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getFinanceData as '00039bbf824c6cf6f3f31d679e5454b7087aa83620'} from 'ACTIONS_MODULE0'\nexport {createTransaction as '40d1d772545060c014e567ca1cc45ca81fa41e0879'} from 'ACTIONS_MODULE0'\nexport {createAccount as '40a6494eb23e86774bbc4cd3b762988938ca6ab1f9'} from 'ACTIONS_MODULE0'\nexport {deleteAccount as '40e0cc86317e5bbbc92ce5488fd0aca39cbd2bb382'} from 'ACTIONS_MODULE0'\nexport {createCategory as '407c575f36b6abf59084d90735f41e90aa840e68ec'} from 'ACTIONS_MODULE0'\nexport {saveSimulatorItem as '40a3a35a0de80c6315f5b4b808492893738d32a019'} from 'ACTIONS_MODULE0'\nexport {deleteSimulatorItem as '402bf14f37e0dac638b5f9d2f991f72f4f1a9b331a'} from 'ACTIONS_MODULE0'\nexport {createFixedRule as '402b83f4bbc7ae16a5a9b415e2c3ecca947aeffc06'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}